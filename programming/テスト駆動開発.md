[テスト駆動開発](https://www.amazon.co.jp/dp/B077D2L69C/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)の要約

イントロダクション
---

「動作する綺麗なコード」がテスト駆動開発のゴール

#### メリット

  - 開発が予測可能になる
  - コードが伝えようとしていることをがわかる
  - 品質が担保できる
  - チームメイトが信頼してくれる
  - 書いていて気持ちがいい

####  方法

- 自動化がされたテストが失敗した時のみ開発する
- 作業の流れ
    1. レッド:  動作しない、コンパイルも通らないテストを1つ書く
    1. グリーン: そのテストを迅速に動作させる。通すためなら何をしてもいい
    1. リファクタリング:  テストを通すために発生した重複を除去する
- 詳細な作業の流れ
    1. テストを1つ書く
    1. 全てのテストを走らせ、新しいテストの失敗を確認
    1.  小さな変更を行う
    1.  全てのテストを走らせ、全て成功することを確認する
    1. リファクタリングを行なって重複を除去する

1部 他国通貨
---
他国通貨計算のプログラムを例にし、テストをコードより先に書き、設計する方法を学ぶ

-  1章: 仮実装: まずテストを書いて、テストを通すためならベタがきのコードでもとりあえず動かせ
-  2章: 明白な実装: 仮実装(ベタ書き)と明白な実装(リファクタ)を揺れ動かしながら開発する
-  3章: 三角測量を行う: コードを一般化する時には二つのテストケースを用意する
``` java
private int plus(int augend, int addend) {
    return 4;
}

@Test
public void testSum() {
    // 1つのテストだとこれはOKなのでplus()が間違っていることがわかない
    assertEquals(4, plus(3, 1))
    // 2つだとこれはNGなのでplus()が間違っていることがわかる、リファクタが終われば冗長なテストなので消す
    assertEquals(7, plus(3, 4))
}
```
- 4章  意図を語るテスト         : アサーションメソッドに渡す値は意図がわかりやすいものにする(new Instanceするなど)
- 5章  原則をあえて破るとき     : コピペしてもいいからまずはテストを通せ
- 6章  テスト不足に気がついたら : あればよかったなーというテストはリファクタの前に追加して書くべき
- 7章  疑念をテストに翻訳する   : 疑問に思うことも先にテストしてテストを通すコードを書け
- 8章  実装を隠す               : 不要なコードがあると気がついたらテストを変える前にそのコード実装自体を消せるように変更加える(テストが通った状態で)
- 9章  歩幅の調整               : 修正の単位に決まりはないので、大きいと思ったら小さくし、小さいと思ったら大きくして良い
- 10章 テストに聞いてみる       : リファクタ中わかんなくなったらとりあえずテストを実行しろ、それでもわからないなら追加でテストを書け
- 11章 不要になったら消す       : 不要なコードを削除、テストもいらなくなったらテストコードも削除
- 12章 設計とメタファー         : 設計を変更する際はそのメタファーにあったようなテストコードに書き直す
- 13章 実装を導くテスト : こう実装すれば良いよを先にテストに書いてその通り実装する（難しくない？）
- 14章 学習用テストと回帰テスト: 今まで書いてたテストで失敗したら、原因の最小単位を試すテストを書く。設計もれと思おう。
- 15章 テスト任せとコンパイラ任せ: リファクタ時にはテストの前にコンパイラ任せにすると実装を導けるよね（セヤナ）
- 16章 将来の読み手を考えたテスト:  自分だけが触るコード！であれば結合テストくらいでいいのでは？
  > TDDをやっていると、テストコードとプロダクトコードの行数は、同じくらいになる。つまりこれまでの2倍コードをかけるようになるか、半分のコード量で同じだけの機能をかけるようになるかしかないと、TDDのメリットを得られ無いということだ。
  > 実装だけではなく、デバッグやインテグレーション、人への説明などに要する時間も考慮することを忘れずに。
- 17章 : 他国通貨の全体振り返り
  - TDDで作ったテストは以下のテストの代替にはならない
    - パフォーマンステスト
    - 負荷テスト
    - ユーザビリティテスト
  - カバレッジを上げる方法はテストコードをたくさんかくだけじゃなく、ロジックをシンプルにするという方法もある


2部 xUnit
---
複雑なロジック、リフレクションや例外のテスト方法を学ぶ
自分でテスティングフレームワークを作りながら上記を学ぼうという内容（何をしてるのか最初わからなかった…）
なお、TDDの理念にのっとり上記のテスティングフレームワークももちろんテストを先に書きながら進めます
写経: https://github.com/hyakt/test_driven_development

- 18章 xUnit(自作のテストフレームワーク)へ向かう小さな一歩:  テストメソッドを呼び出せるように実装
- 19章 前準備: setUp() メソッドを実装し、できるだけ早く、他のテストの影響を受けないようした
- 20章 後片付け: tearDown() メソッドを実装し、リソースの開放を行えるようにした
- 21章 数え上げ: テストの実行結果を「5 run, 2 failed」などわかるように実装
- 22章 失敗の扱い: 例外が発生した場合 failed + 1 してあげるのを実
- 23章 スイートにまとめる: テストをまとめて実行できるクラスを追加
- 24章 xUnitの全体振り返り
  - 熟達: xUnitは様々な言語で実装されているが、それを自分で実装することで1から理解できる
  - 探索: xUnitを実装することで、プログラミング言語自体の必要機能が網羅できる

3部 テスト駆動開発のパターン
---
どのようなテストを各課の判断に関するパターンを学ぶ
TDDのベストヒットパターン集

- 25章 テスト駆動開発のパターン
  - テスト（名詞）
    - 自動テストを書いておけば変更ポイントが増加し続けてもストレスを感じにくくなる
  - 独立したテスト
    1. テストの速度を可能な限り早くして、自分で頻繁に走らせられるようにすること
    2. テストは互いに影響が受けない独立したものにすること
  - TODOリスト
    - リストに加えるのは、実装したいものに対するテスト
    - リストを書く前にテストを書いちゃうと逆に手戻りが多くなったり途中で追加したくなってしまう
  - テストファースト
    - 実装を終えてしまったら後でテスト書かないだろう（そうか？そうかも）
    - テストを先に書くと最終的にストレスを減らせるよ
  - アサートファースト
    - テストの終わりにパスすべきアサーションから書き始めよう
      - テストがシンプルになる
      - 正しい結果とは何か、それをどう検証するかの2つが明らかになる
  - テストデータ
    - テストを読みやすく、理解しやすくなるデータを使おう
    - 入力値として3つの要素しか使わずに妥当な設計と実装を導き出せるなら要素を10個用意する必要はない
    - 同じ値は1つのものを表すためだけに使う: `add = (x,y) => x + y `と言う関数があったら テストは `assert(add(1, 2) == 3)`と言う感じにした方が良い。
    - 本物に近いデータを利用する
  - 明示的なデータ
    - 入力値と期待値は実際のコードに則ったものにした方がみんながわかる
- 26章 レッドバーのパターン: いつどこにテストをかき、いつ辞めるか説明する
  - 最初の一歩: その時に考えた最後のテストが最初に書くテスト。書けば動かせそうな気がするテスト
  - はじめのテスト: どのテストから始めたら良いか → 何もしないテスト → 出力と入力が完全に一致するケース or 入力が可能な限り小さいもの
  - 説明的なテスト: テストを読むとロジックの意味がわかるようなテストを書こう。質問もテストベースにするとチームにもTDDが普及する。
  - 学習用テスト: チームの誰かがかいたソフトウェアのテストを書くと、理解が深まる
  - 脱線はTODOリストへ: 4個目のロジックを書いて、素敵なアイディアが思いついたとしても時間を棒に振らないためにもTODOリストに書いて目の前のことに集中しよう
  - 回帰テスト: 回帰テストとはコードを書いた時に同時に書かれるべきだったテスト。不具合が発見された時に最小のテストケースを書き、失敗を見届けよう
  - 休憩: シャワーメソッド。書くべきものがわからない時は書くべきものが降りてくるまで浴び続ける。煮詰まった時はPCから離れろ！
  - やり直す: 手詰まりした時は、1度最初から見直してみる
  - やすいつくえと良い椅子：椅子だけはとにかくいいものを使え(わかる)
- 27章: テスティングのパターン
  - 小さいテスト: テストが大きくなったら問題箇所を絞り込んだ小さいテストをかき、それだけを走らせよう
  - Mock Object (擬似オブジェクト)　パターン
    - データベースなどの処理はモックオブジェクトに置き換える
    - Mock Objectを使うと、必然的にオブジェクトの可視性に留意するようになり、コードの結合度を低く抑えることにつながる
  - Self Shunt (自己接続) パターン
    - テストケース自身のオブジェクトをテスト対象のオブジェクトに利用する
  - Log String (記録用文字列) パターン
    - 正しい順序でメソッドが呼び出しが行われていることをテストしたいときは記録用の文字列を作り、メソッド呼び出しのたびにその文字列に追記するようにする
    - Observerパターンを実装していて特定の順番で通知が行われていことを検証したいとき
  - Crash Test Dummy (衝突実験ダミー人形) パターン
    - 特定の例外に対するテストは、オブジェクトの特定のメソッドだけ実装したものを利用する
  - 失敗させたままのテスト
    - 個人のコーディング時間のうまい終わらせ方は、最後に書いていたテストを失敗する状態にして終えよう。戻る時の理解が早くなる。
  - きれいなチェックイン
    - チームで仕事している時は、自信と確信がある場所から仕事を始めなければならない。つまり、コードをチェックインする前には全てのテストが通ることを常に確認しよう
- 28章: グリーンバーのパターンでたら
  - 仮実装を書いて本実装へ
    - テストが間違えていることもある。仮実装を書くことでそれがわかる。
    - 心理的効果: グリーンバーとレッドバーでは安心感が違う
    - スコープ制御: 本質と関係ない問題に気を取られず作業を行えるようになる
  - 三角測量
    - 一つのロジックに大して2つアサーションを書くことで、本当に関数が正しく動くか確認する。終わったら消す
  - 明白な実装
    - 実装が当たり前のシンプルな実装であれば仮実装する必要ない。レッドバーがでたら小さくする
  - 1から多へ
    - コレクションのテストは単体をかいて複数をテストする
- 29章: xUnitのパターン: テスティングフレームワークを使う際のパターンを説明
  - アサーション:
    - 判断は真偽値で行う、falseの場合は何か予期しないことがおこっているようにする
    - 真偽値の調査はコンピュータにさせる
    - assert(期待値, 実際値)の順で書くことが多い
    - 実装に着目せず、振る舞いに注目して書く（しかしこれが難しい）
  - フィクスチャー
    - 複数のテストから利用されるオブジェクトは、テストメソッドないのローカル変数をインスタンス変数に引き上げ、setUp()メソッドの中で初期化を行う
    - 各テストに書いても良い。どちらを選ぶかは場合によって判断する
  - 外部フィクスチャー
    - フィクスチャーは状態を完全に回復するためtearDown()メソッドをオーバライドし、リソースを開放しよう
  - テストメソッド
    - テストを書くときは何を書くかのアウトラインを作り始めると良さそう
  - 例外のテスト
    - テストの中にfail()メソッドをかき、期待した例外がキャッチできることを確認する
- 30章: デザインパターン: デザパタの列挙なのでここではまとめません
  - Singletonパターン: そんなことを考える時間は設計に回して、コードをきれいにしよう（笑）
- 31章: リファクタリング
  - TDDにおいてリファクタリングと言うのはテストが通っていることさえ担保できていれば、プログラムの意味を変えても良い
  - それはテストにおいて十分なテストを書かれているという前提
  - 差異をなくす
    - 変更の分離: 複数の部分から構成されるメソッドあるいはオブジェクトを変更するには、変更すべき部分を独立させる
    - データ構造の分離: データの持ち方を帰るにはデータを一時的に複製しよう
    - メソッドの抽出: 込み入ったメソッドを読みやすくするにはメソッドの一部分を別のメソッドに分離する
    - メソッドのインライン化: 散らかった制御フローをメソッドそのもので置き換える
    - インターフェースの抽出: ある処理の実装をもう1種類作る時はinterfaceを作り、共通の処理をくくり出そう
    - メソッドの移動: メソッドをふさわしい場所に移動するにはあるべきところにメソッドを加え、それを呼び出すようにしよう
    - メソッドオブジェクト: 複数のパラメータやローカル変数を必要するとメソッドを表現する際はオブジェクトとしてくくりだそう
    - パラメータの追加: インターフェースの方に先にパラメータを追加する
- 32章: TDDを身に着ける: 
  

## 感想
- 1章はTDD全体の流れがわかってためになる
- 2章はテストフレームワーク開発に興味のある人が読めばいい内容かも
- 3章もじゃあこう言う時どうかくんだよと言うのがわかるのでtipsみたいに利用すると良いかも


